#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
### Everything below [include RatOS.cfg] will override default RatOS behavior
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[gcode_macro RatOS]
variable_relative_extrusion: False
variable_preheat_extruder: True
variable_calibrate_bed_mesh: True
variable_nozzle_priming: False
variable_start_print_park_in: "back"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "back"

#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A axis motor for the toolhead, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin        # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -0          # FÖB - changed from -59.5
position_max: 360         # FÖB - changed from 359.5
position_endstop: -0      # FÖB - changed from -59.5

#---------------------------------------------------- X1 ----------------------------------------------------
# The B axis motor for the toolhead, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_x1]
dir_pin: x1_dir_pin       # Add ! in front of pin name to reverse the direction of stepper_x1
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys

#---------------------------------------------------- Y -----------------------------------------------------
# The left Y motor used for cartesian Y control in Hybrid CoreXY, located at the rear left of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: !y_dir_pin       # Remove ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: -15         # FÖB - changed from -14.35
position_max: 305         # FÖB - changed from 330
position_endstop: 305     # FÖB - changed from -14.35

#---------------------------------------------------- Y1 ----------------------------------------------------
# The right Y motor used for cartesian Y control in Hybrid CoreXY, located at the rear right of the printer
#------------------------------------------------------------------------------------------------------------
[stepper_y1]
dir_pin: y1_dir_pin       # Add ! in front of pin name to reverse the direction of stepper_y1
rotation_distance: 40     # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys

#---------------------------------------------------- Z -----------------------------------------------------
# The left Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 4      # 4 for TR8*4 lead screws
homing_speed: 5 
position_min: -5
position_max: 300

#---------------------------------------------------- Z1 ----------------------------------------------------
# The rear Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z1]
dir_pin: !z1_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z1
rotation_distance: 4      # 4 for TR8*4 lead screws

#---------------------------------------------------- Z2 ----------------------------------------------------
# The right Z motor for the kinematic bed
#------------------------------------------------------------------------------------------------------------
[stepper_z2]
dir_pin: !z2_dir_pin      # Remove ! in front of pin name to reverse the direction of stepper_z2
rotation_distance: 4      # 4 for TR8*4 lead screws

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for pushing filament through the toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: e_dir_pin        # Add ! in front of pin name to reverse the direction of extruder
rotation_distance: 35.8   # VzBot VZ-HextrudORT Plus default
#pressure_advance: 0.05   # Check https://www.klipper3d.org/Pressure_Advance.html for pressure advance tuning.
#control: pid
#pid_kp: 28.413
#pid_ki: 1.334
#pid_kd: 151.300

[heater_bed]
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114

# Probe configuration
[probe]
#z_offset: 0.0 # Will be commented out after a successful PROBE_CALIBRATE and SAVE_CONFIG
pin: ^probe_pin# For NPN NC probes such as the Super Pinda / Vinda / SupCR / Decoprobe probes.
#pin: ^!probe_pin # NPN NO (refer to the specs of your probe)
#pin: probe_pin # PNP NO (refer to the specs of your probe)
#pin: !probe_pin # PNP NC (refer to the specs of your probe)


#------------------------------------------------- FÖB - PROBE ----------------------------------------------
# Euclid probe configuration
#------------------------------------------------------------------------------------------------------------
[gcode_macro RatOS]
variable_stowable_probe_position_preflight: [ 45.0, 60.0 ]
variable_stowable_probe_position_side:      [ 45.0, 4.0 ]
variable_stowable_probe_position_dock:      [  7.0, 4.0 ]
variable_stowable_probe_position_exit:      [  7.0, 60.0 ]

[ratos_homing]
z_hop: 10

[probe]
pin: ^probe_pin
x_offset: -22.5
y_offset: -11.3
speed: 5
lift_speed: 15
samples: 1                   ; number of probes to perform per sample
sample_retract_dist: 1.0

#------------------------------------------------- FÖB - PARKING --------------------------------------------
# Parking
#------------------------------------------------------------------------------------------------------------
[gcode_macro RatOS]
variable_start_print_park_z_height: 10
variable_end_print_park_z_hop: 10

#------------------------------------------------- FÖB - BED MESH -------------------------------------------
# Bed mesh configuration
#------------------------------------------------------------------------------------------------------------
[bed_mesh]
horizontal_move_z: 10
probe_count: 12,12
speed: 300

[z_tilt]
horizontal_move_z: 10
points:
	80,30
	175,260
	280,30

#------------------------------------------------- FÖB - KINEMATICS -----------------------------------------
# Kinematics
#------------------------------------------------------------------------------------------------------------
[printer]
max_velocity: 1000
max_accel: 5000
max_z_velocity: 30
max_z_accel: 750

#------------------------------------------------- FÖB - COOLING --------------------------------------------
# CPAP part cooling fan
#------------------------------------------------------------------------------------------------------------
[fan]
cycle_time: 0.01
enable_pin: PA3

#------------------------------------------------- FÖB - EXTRUDER -------------------------------------------
# VZ-Hextrudor configuration
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: !e_dir_pin       # Add ! in front of pin name to reverse the direction of extruder
rotation_distance: 22.2   #FÖB - changed from 35.8   # VzBot VZ-HextrudORT Plus default
gear_ratio: 50:8
max_extrude_only_velocity: 120
max_extrude_only_accel: 800
microsteps: 16

#------------------------------------------------- FÖB - LED ------------------------------------------------
# LED control
#------------------------------------------------------------------------------------------------------------
[output_pin caselight]
# Chamber Lighting - HE2 Connector (Optional)
pin: PB10


#------------------------------------------------- FÖB - ALLOW UNSUPPORTED SLICER VERSIONS ------------------
# ALLOW UNSUPPORTED SLICER VERSIONS
#------------------------------------------------------------------------------------------------------------
[ratos]
allow_unsupported_slicer_versions: True

#------------------------------------------------- FÖB - SUPPORT GCODE ARC (G2/G3/G17) COMMANDS -------------
# ASUPPORT GCODE ARC (G2/G3/G17) COMMANDS
#------------------------------------------------------------------------------------------------------------

[gcode_arcs]

#------------------------------------------------- FÖB - FIRMWARE RETRACTION---------------------------------
# Firmware retraction
#------------------------------------------------------------------------------------------------------------
#[firmware_retraction]
#retract_length: 0.4
#   The length of filament (in mm) to retract when G10 is activated,
#   and to unretract when G11 is activated (but see
#   unretract_extra_length below). The default is 0 mm.
#retract_speed: 120
#   The speed of retraction, in mm/s. The default is 20 mm/s.
#unretract_extra_length: 0
#   The length (in mm) of *additional* filament to add when
#   unretracting.
#unretract_speed: 120
#   The speed of unretraction, in mm/s. The default is 10 mm/s.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 24.401
#*# pid_ki = 1.415
#*# pid_kd = 105.230
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 58.918
#*# pid_ki = 1.870
#*# pid_kd = 463.981
#*#
#*# [probe]
#*# z_offset = 6.920
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  0.012812, -0.010000, -0.067500
#*# 	  0.004687, -0.062188, -0.104375
#*# 	  -0.012813, -0.065313, -0.087500
#*# x_count = 3
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 117.656
#*# max_x = 181.336
#*# min_y = 122.206
#*# max_y = 177.786
#*#
#*# [input_shaper]
#*# shaper_type_x = 3hump_ei
#*# shaper_freq_x = 85.4
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 59.8
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.030632, 0.022194, -0.015306, -0.011556, -0.022806, -0.024368, -0.035618, -0.014681
#*# 	0.045632, 0.016882, -0.018118, -0.008431, -0.035931, -0.029368, -0.003431, -0.025306
#*# 	0.085319, 0.046569, 0.015944, 0.032819, -0.000931, -0.018118, -0.022181, 0.010007
#*# 	0.093444, 0.062194, 0.027819, 0.054069, -0.003118, -0.045931, -0.061868, -0.029681
#*# 	0.087194, 0.059069, 0.023757, 0.011257, -0.034681, -0.057181, -0.085618, -0.098431
#*# 	0.097819, 0.060632, 0.001569, -0.000306, -0.057181, -0.093431, -0.086556, -0.114368
#*# 	0.132194, 0.094694, 0.069069, -0.003118, -0.039056, -0.061556, -0.103118, -0.075306
#*# 	0.136569, 0.105944, 0.048132, 0.019069, -0.041868, -0.070306, -0.097493, -0.084993
#*# x_count = 8
#*# y_count = 8
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 269.96000000000004
#*# min_y = 30.0
#*# max_y = 249.94000000000005
